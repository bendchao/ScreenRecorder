# 屏幕录制工具

这是一个功能完善的屏幕录制工具，支持屏幕录制、键盘记录、文件压缩和远程上传等功能。

## 程序架构

项目采用模块化设计，主要包含以下功能模块及其交互关系：

```
+----------------+     +-----------------+     +----------------+
|   MainForm     |<--->| ScreenRecorder  |<--->| FileCompressor |
+----------------+     +-----------------+     +----------------+
       ↑                      ↑                        ↓
       |                      |                +----------------+
+----------------+     +-----------------+     |   FileUploader |
| KeyboardHook   |     | AutoUploadTimer |----->+----------------+
+----------------+     +-----------------+         ↑
                                            +----------------+
                                            | UploadQueueMgr |
                                            +----------------+
```

### 模块职责
1. **MainForm**：
   - 用户界面控制中心
   - 协调各模块工作流程
   - 处理用户交互事件

2. **ScreenRecorder**：
   - 屏幕画面捕获
   - 视频流编码处理
   - 录制文件管理

3. **KeyboardHook**：
   - 全局键盘钩子设置
   - 按键事件记录
   - 输入行为分析

### 主要文件

- **MainForm.cs** - 主窗口类，负责用户界面交互和协调各功能模块
- **ScreenRecorder.cs** - 屏幕录制核心功能实现
- **KeyboardHook.cs** - 键盘钩子功能，用于记录键盘输入
- **FileCompressor.cs** - 文件压缩功能，使用7z库进行高效压缩
- **FileUploader.cs** - 文件上传功能，负责将文件上传到远程服务器
- **AutoUploadTimer.cs** - 自动上传定时器，定时触发自动上传功能

## 功能说明

### 屏幕录制
- 支持全屏幕录制
- 可调整视频质量和帧率
- 在录制过程中显示鼠标指针位置
- 实时显示录制帧数量

### 键盘记录
- 记录用户在录制过程中的键盘输入
- 保存为文本文件，包含按键时间戳和修饰键信息

### 文件压缩
- 使用7z格式进行高效压缩
- 支持压缩视频文件和键盘记录文件
- 提供两种压缩模式：
  - 普通压缩（带进度显示和压缩信息）
  - 自动上传压缩（无用户交互）

### 文件上传
- 支持将压缩文件上传到指定的远程服务器
- 可自定义远程服务器URL
- 显示上传进度
- 上传完成后自动删除临时文件

### 自动上传
- 可设置定时自动上传间隔
- 自动上传时会创建新的录制文件继续录制
- 自动上传完成后通知用户

## 技术栈

- .NET 6.0
- Windows Forms
- SharpAvi (视频录制库)
- SevenZipSharp (文件压缩库)
- HttpClient (文件上传)

## 使用说明

1. 运行程序后，点击"开始录制"按钮开始录制屏幕
2. 在录制过程中，可通过滑块调整视频质量
3. 点击"停止录制"按钮结束录制
4. 录制完成后，可以选择是否压缩并上传文件
5. 在录制过程中，系统会根据设置的间隔自动上传录制内容

## 配置说明

### 核心配置参数
```json
{
  "Recording": {
    "FrameRate": 10,       // 帧率范围(1-60)
    "Quality": 20,         // 视频质量(0-100)
    "CaptureCursor": true // 是否捕获鼠标
  },
  "Compression": {
    "Level": 5,            // 压缩等级(1-9)
    "Threads": 2,          // 压缩线程数
    "DeleteSource": false // 压缩后删除源文件
  },
  "Upload": {
    "Endpoint": "http://192.168.79.28:5198/api/upload/file",
    "Timeout": 300,        // 上传超时(秒)
    "Retries": 3,         // 失败重试次数
    "ChunkSize": 10485760 // 分块上传大小(10MB)
  },
  "AutoUpload": {
    "Interval": 600,       // 自动上传间隔(秒)
    "MaxFiles": 5,         // 队列最大文件数
    "EnableLogging": true // 启用上传日志
  }
}
```

### 配置方式
1. 通过`上传队列.json`修改运行时配置
2. 程序启动时自动加载`config.json`
3. 主界面设置面板实时更新参数

### 高级配置项
| 分类       | 参数名称           | 类型   | 默认值 | 说明                      |
|------------|--------------------|--------|--------|---------------------------|
| 录制       | AudioCapture       | bool   | false  | 是否捕获系统音频          |
| 压缩       | CompressionMethod  | string | LZMA2  | 压缩算法(LZMA2/PPMd)      |
| 网络       | ProxyServer        | string | null   | 代理服务器地址:端口        |
| 安全       | EnableEncryption   | bool   | false  | 上传文件是否启用AES加密   |
| 日志       | LogRetentionDays   | int    | 7      | 日志文件保留天数          |

## 注意事项

- 录制文件默认保存在程序目录下的"ScreenCaptures"文件夹中
- 程序需要7-Zip库支持文件压缩功能
- 上传功能需要远程服务器支持
- 键盘记录功能可能会记录敏感信息，请谨慎使用